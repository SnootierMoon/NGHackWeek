<!--TODO: sql filter search bar
    TODO: would be nice if specs were in order of how common they were-->
<!DOCTYPE html>
<html>
<head>
  <title>{{ query[0]|upper }}{{ query[1:] }} Search Results</title>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="static/css/search.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      $('input[type="checkbox"]').click(function() {
        console.log("checked");
        const selectedSpecs = {};
        $('input[type="checkbox"]').each(function() {
          if ($(this).is(':checked')) {
            selectedSpecs[$(this).attr('id')] = 1;
          }
        });
        console.log(selectedSpecs)
        $.ajax({
          url: '/filter',
          type: 'GET',
          data: selectedSpecs,
          success: function(data) {
            //console.log(data.products[0])
            for (let i=0; i < data.products.length; i++) {
              product = data.products[i];
              console.log(product)
              let textToAdd = ""
              for (let i = 0; i < data.specs.length; i++) {
                if(i != 0) { textToAdd += "<br>"}
                textToAdd += "<b>" + data.specs[i] + "</b>" + ": " + product.specs[i];
              }
              console.log(textToAdd)
              let id = "." + product.url.substring(30);
              console.log(id)
              $(id).html(textToAdd);
            }
          }
        })
      });
    });
  </script>

</head>
<body style="background-color: #ebfaff">
  <div class="container my-5">

    <form action="/search" method="get">
      <div class="form-group">
        <input type="text" class="form-control" name="query" placeholder="Search for a different product">
      </div>
    </form>

    <form>
      <div class="form-group">
        <input type="text" class="form-control" name="query" placeholder="Enter in SQL Commands to Filter (DOES NOTHING CURRENTLY)">
      </div>
    </form>

    <div class="table-container">
      <!-- SPECS TABLE -->
        <table class="left-table">
          <thead>
            <tr>
              <th>Select Specs</th>
            </tr>
          </thead>
          <tbody>
            {% if specs %}
            {% for spec in specs %}
              <tr>
                <td><input type="checkbox" name="specs" value="{{ spec }}" id="{{ spec }}"></td>
                <td>{{ spec|replace('_', ' ') }}</td>
              </tr>
            {% endfor %}
          {% else %}
              <p>no results found</p>
          {% endif %}
          </tbody>
        </table>
      <!-- PRODUCT TABLE -->
      <table>
        <thead>
          <tr>
            <th>Product</th>
            <th>Specs</th>
          </tr>
        </thead>
        <tbody>
            {% if products %}
            {% for prod in products %}
            <tr>
              <td><a href={{prod.url}}>{{prod.name}}</a></td>
              <td class={{prod.url[30:]}}></td>
            </tr> 
            {% endfor %}
            {% else %}
            <p>No results found.</p>
            {% endif %}
        </tbody>
      </table>

    </div>
  </div>
  <div id="content"></div>

    <!-- Bootstrap JS (optional) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  </body>
  </html>